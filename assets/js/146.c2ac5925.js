(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{564:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"简单例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单例子"}},[s._v("#")]),s._v(" 简单例子")]),s._v(" "),a("p",[s._v("老规矩，讲原理前我们先来一个简单的例子，从这个例子入手一步一步深入原理。Node.js里面如果要导出某个内容，需要使用"),a("code",[s._v("module.exports")]),s._v("，使用"),a("code",[s._v("module.exports")]),s._v("几乎可以导出任意类型的JS对象，包括字符串，函数，对象，数组等等。我们先来建一个"),a("code",[s._v("a.js")]),s._v("导出一个最简单的"),a("code",[s._v("hello world")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a.js ")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后再来一个"),a("code",[s._v("b.js")]),s._v("导出一个函数：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// b.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("然后在"),a("code",[s._v("index.js")]),s._v("里面使用他们，即"),a("code",[s._v("require")]),s._v("他们，"),a("code",[s._v("require")]),s._v("函数返回的结果就是对应文件"),a("code",[s._v("module.exports")]),s._v("的值：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" add "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./b.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// "hello world"')]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// b导出的是一个加法函数，可以直接使用，这行结果是3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"require会先运行目标文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#require会先运行目标文件"}},[s._v("#")]),s._v(" require会先运行目标文件")]),s._v(" "),a("p",[s._v("当我们"),a("code",[s._v("require")]),s._v("某个模块时，并不是只拿他的"),a("code",[s._v("module.exports")]),s._v("，而是会从头开始运行这个文件，"),a("code",[s._v("module.exports = XXX")]),s._v("其实也只是其中一行代码，我们后面会讲到，这行代码的效果其实就是修改模块里面的"),a("code",[s._v("exports")]),s._v("属性。比如我们再来一个"),a("code",[s._v("c.js")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// c.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("在"),a("code",[s._v("c.js")]),s._v("里面我们导出了一个"),a("code",[s._v("c")]),s._v("，这个"),a("code",[s._v("c")]),s._v("经过了几步计算，当运行到"),a("code",[s._v("module.exports = c;")]),s._v("这行时"),a("code",[s._v("c")]),s._v("的值为"),a("code",[s._v("2")]),s._v("，所以我们"),a("code",[s._v("require")]),s._v("的"),a("code",[s._v("c.js")]),s._v("的值就是"),a("code",[s._v("2")]),s._v("，后面将"),a("code",[s._v("c")]),s._v("的值改为了"),a("code",[s._v("6")]),s._v("并不影响前面的这行代码:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./c.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// c的值是2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("前面"),a("code",[s._v("c.js")]),s._v("的变量"),a("code",[s._v("c")]),s._v("是一个基本数据类型，所以后面的"),a("code",[s._v("c = 6;")]),s._v("不影响前面的"),a("code",[s._v("module.exports")]),s._v("，那他如果是一个引用类型呢？我们直接来试试吧：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// d.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("然后在"),a("code",[s._v("index.js")]),s._v("里面"),a("code",[s._v("require")]),s._v("他：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./d.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { num: 6 }")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("我们发现在"),a("code",[s._v("module.exports")]),s._v("后面给"),a("code",[s._v("d.num")]),s._v("赋值仍然生效了，因为"),a("code",[s._v("d")]),s._v("是一个对象，是一个引用类型，我们可以通过这个引用来修改他的值。其实对于引用类型来说，不仅仅在"),a("code",[s._v("module.exports")]),s._v("后面可以修改他的值，在模块外面也可以修改，比如"),a("code",[s._v("index.js")]),s._v("里面就可以直接改：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./d.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { num: 7 }")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"require和module-exports不是黑魔法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#require和module-exports不是黑魔法"}},[s._v("#")]),s._v(" "),a("code",[s._v("require")]),s._v("和"),a("code",[s._v("module.exports")]),s._v("不是黑魔法")]),s._v(" "),a("p",[s._v("我们通过前面的例子可以看出来，"),a("code",[s._v("require")]),s._v("和"),a("code",[s._v("module.exports")]),s._v("干的事情并不复杂，我们先假设有一个全局对象"),a("code",[s._v("{}")]),s._v("，初始情况下是空的，当你"),a("code",[s._v("require")]),s._v("某个文件时，就将这个文件拿出来执行，如果这个文件里面存在"),a("code",[s._v("module.exports")]),s._v("，当运行到这行代码时将"),a("code",[s._v("module.exports")]),s._v("的值加入这个对象，键为对应的文件名，最终这个对象就长这样：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("当你再次"),a("code",[s._v("require")]),s._v("某个文件时，如果这个对象里面有对应的值，就直接返回给你，如果没有就重复前面的步骤，执行目标文件，然后将它的"),a("code",[s._v("module.exports")]),s._v("加入这个全局对象，并返回给调用者。这个全局对象其实就是我们经常听说的缓存。**所以"),a("code",[s._v("require")]),s._v("和"),a("code",[s._v("module.exports")]),s._v("并没有什么黑魔法，就只是运行并获取目标文件的值，然后加入缓存，用的时候拿出来用就行。**再看看这个对象，因为"),a("code",[s._v("d.js")]),s._v("是一个引用类型，所以你在任何地方获取了这个引用都可以更改他的值，如果不希望自己模块的值被更改，需要自己写模块时进行处理，比如使用"),a("code",[s._v("Object.freeze()")]),s._v("，"),a("code",[s._v("Object.defineProperty()")]),s._v("之类的方法。")]),s._v(" "),a("h2",{attrs:{id:"模块类型和加载顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块类型和加载顺序"}},[s._v("#")]),s._v(" 模块类型和加载顺序")]),s._v(" "),a("p",[s._v("这一节的内容都是一些概念，比较枯燥，但是也是我们需要了解的。")]),s._v(" "),a("h3",{attrs:{id:"模块类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模块类型"}},[s._v("#")]),s._v(" 模块类型")]),s._v(" "),a("p",[s._v("Node.js的模块有好几种类型，前面我们使用的其实都是"),a("code",[s._v("文件模块")]),s._v("，总结下来，主要有这两种类型：")]),s._v(" "),a("blockquote",[a("ol",[a("li",[a("strong",[s._v("内置模块")]),s._v("：就是Node.js原生提供的功能，比如"),a("code",[s._v("fs")]),s._v("，"),a("code",[s._v("http")]),s._v("等等，这些模块在Node.js进程起来时就加载了。")]),s._v(" "),a("li",[a("strong",[s._v("文件模块")]),s._v("：我们前面写的几个模块，还有第三方模块，即"),a("code",[s._v("node_modules")]),s._v("下面的模块都是文件模块。")])])]),s._v(" "),a("h3",{attrs:{id:"加载顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载顺序"}},[s._v("#")]),s._v(" 加载顺序")]),s._v(" "),a("p",[s._v("加载顺序是指当我们"),a("code",[s._v("require(X)")]),s._v("时，应该按照什么顺序去哪里找"),a("code",[s._v("X")]),s._v("，在官方文档上有"),a("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fdist%2Flatest-v12.x%2Fdocs%2Fapi%2Fmodules.html%23modules_all_together",title:"https://nodejs.org/dist/latest-v12.x/docs/api/modules.html#modules_all_together",target:"_blank",rel:"noopener noreferrer"}},[s._v("详细伪代码"),a("OutboundLink")],1),s._v("，总结下来大概是这么个顺序：")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("优先加载内置模块，即使有同名文件，也会优先使用内置模块。")]),s._v(" "),a("li",[s._v("不是内置模块，先去缓存找。")]),s._v(" "),a("li",[s._v("缓存没有就去找对应路径的文件。")]),s._v(" "),a("li",[s._v("不存在对应的文件，就将这个路径作为文件夹加载。")]),s._v(" "),a("li",[s._v("对应的文件和文件夹都找不到就去"),a("code",[s._v("node_modules")]),s._v("下面找。")]),s._v(" "),a("li",[s._v("还找不到就报错了。")])])]),s._v(" "),a("h3",{attrs:{id:"加载文件夹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载文件夹"}},[s._v("#")]),s._v(" 加载文件夹")]),s._v(" "),a("p",[s._v("前面提到找不到文件就找文件夹，但是不可能将整个文件夹都加载进来，加载文件夹的时候也是有一个加载顺序的：")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("先看看这个文件夹下面有没有"),a("code",[s._v("package.json")]),s._v("，如果有就找里面的"),a("code",[s._v("main")]),s._v("字段，"),a("code",[s._v("main")]),s._v("字段有值就加载对应的文件。所以如果大家在看一些第三方库源码时找不到入口就看看他"),a("code",[s._v("package.json")]),s._v("里面的"),a("code",[s._v("main")]),s._v("字段吧，比如"),a("code",[s._v("jquery")]),s._v("的"),a("code",[s._v("main")]),s._v("字段就是这样："),a("code",[s._v('"main": "dist/jquery.js"')]),s._v("。")]),s._v(" "),a("li",[s._v("如果没有"),a("code",[s._v("package.json")]),s._v("或者"),a("code",[s._v("package.json")]),s._v("里面没有"),a("code",[s._v("main")]),s._v("就找"),a("code",[s._v("index")]),s._v("文件。")]),s._v(" "),a("li",[s._v("如果这两步都找不到就报错了。")])])]),s._v(" "),a("h3",{attrs:{id:"支持的文件类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持的文件类型"}},[s._v("#")]),s._v(" 支持的文件类型")]),s._v(" "),a("p",[a("code",[s._v("require")]),s._v("主要支持三种文件类型：")]),s._v(" "),a("blockquote",[a("ol",[a("li",[a("strong",[s._v(".js")]),s._v("："),a("code",[s._v(".js")]),s._v("文件是我们最常用的文件类型，加载的时候会先运行整个JS文件，然后将前面说的"),a("code",[s._v("module.exports")]),s._v("作为"),a("code",[s._v("require")]),s._v("的返回值。")]),s._v(" "),a("li",[a("strong",[s._v(".json")]),s._v("："),a("code",[s._v(".json")]),s._v("文件是一个普通的文本文件，直接用"),a("code",[s._v("JSON.parse")]),s._v("将其转化为对象返回就行。")]),s._v(" "),a("li",[a("strong",[s._v(".node")]),s._v("："),a("code",[s._v(".node")]),s._v("文件是C++编译后的二进制文件，纯前端一般很少接触这个类型。")])])]),s._v(" "),a("h4",{attrs:{id:"参考文章链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章链接"}},[s._v("#")]),s._v(" 参考文章链接")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7097067108663558151",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入Node.js的模块加载机制，手写require函数"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);